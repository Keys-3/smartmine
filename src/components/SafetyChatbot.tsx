import { useState, useRef, useEffect } from 'react';
import { MessageSquare, Send, X, Languages, AlertTriangle, Heart, Wind, ThermometerSun, Droplets, MapPin, Shield } from 'lucide-react';

interface Message {
  id: string;
  text: string;
  sender: 'user' | 'bot';
  timestamp: Date;
}

interface SafetyTip {
  keyword: string[];
  responseEn: string;
  responseHi: string;
}

const safetyTips: SafetyTip[] = [
  {
    keyword: ['hello', 'hi', 'hey', 'start', 'namaste'],
    responseEn: 'Hello! I am your mining safety assistant. I can provide emergency tips and safety guidance. Ask me about:\nтАв High heart rate\nтАв Air toxicity\nтАв Temperature issues\nтАв Emergency procedures\nтАв Safety equipment\n\nHow can I help you today?',
    responseHi: 'рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ рдЦрдирди рд╕реБрд░рдХреНрд╖рд╛ рд╕рд╣рд╛рдпрдХ рд╣реВрдВред рдореИрдВ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реБрдЭрд╛рд╡ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред рдореБрдЭрд╕реЗ рдкреВрдЫреЗрдВ:\nтАв рдЙрдЪреНрдЪ рд╣реГрджрдп рдЧрддрд┐\nтАв рд╡рд╛рдпреБ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛\nтАв рддрд╛рдкрдорд╛рди рд╕рдорд╕реНрдпрд╛рдПрдВ\nтАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ\nтАв рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг\n\nрдЖрдЬ рдореИрдВ рдЖрдкрдХреА рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?'
  },
  {
    keyword: ['heart rate', 'heartbeat', 'pulse', 'heart', 'bpm', 'рд╣реГрджрдп', 'рджрд┐рд▓', 'рдзрдбрд╝рдХрди'],
    responseEn: 'ЁЯлА HIGH HEART RATE EMERGENCY:\n\n1. STOP all physical activity immediately\n2. Sit down and rest in a safe location\n3. Take slow, deep breaths (inhale 4 sec, hold 4 sec, exhale 4 sec)\n4. Alert your supervisor via radio\n5. If above 120 BPM for >2 minutes, evacuate to surface\n6. Drink water if available\n7. Loosen any tight clothing\n\nтЪая╕П SEEK MEDICAL HELP if:\nтАв Heart rate stays above 120 BPM\nтАв Chest pain or pressure\nтАв Difficulty breathing\nтАв Dizziness or fainting',
    responseHi: 'ЁЯлА рдЙрдЪреНрдЪ рд╣реГрджрдп рдЧрддрд┐ рдЖрдкрд╛рддрдХрд╛рд▓:\n\n1. рддреБрд░рдВрдд рд╕рднреА рд╢рд╛рд░реАрд░рд┐рдХ рдЧрддрд┐рд╡рд┐рдзрд┐ рдмрдВрдж рдХрд░реЗрдВ\n2. рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рдмреИрдареЗрдВ рдФрд░ рдЖрд░рд╛рдо рдХрд░реЗрдВ\n3. рдзреАрдореА, рдЧрд╣рд░реА рд╕рд╛рдВрд╕реЗрдВ рд▓реЗрдВ (4 рд╕реЗрдХрдВрдб рд╕рд╛рдВрд╕ рд▓реЗрдВ, 4 рд╕реЗрдХрдВрдб рд░реЛрдХреЗрдВ, 4 рд╕реЗрдХрдВрдб рдЫреЛрдбрд╝реЗрдВ)\n4. рд░реЗрдбрд┐рдпреЛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрдиреЗ рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рдХреЛ рд╕реВрдЪрд┐рдд рдХрд░реЗрдВ\n5. рдпрджрд┐ 2 рдорд┐рдирдЯ рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ 120 BPM рд╕реЗ рдКрдкрд░ рд╣реИ, рддреЛ рд╕рддрд╣ рдкрд░ рдирд┐рдХрд▓реЗрдВ\n6. рдпрджрд┐ рдЙрдкрд▓рдмреНрдз рд╣реЛ рддреЛ рдкрд╛рдиреА рдкрд┐рдПрдВ\n7. рдХреЛрдИ рднреА рддрдВрдЧ рдХрдкрдбрд╝реЗ рдвреАрд▓рд╛ рдХрд░реЗрдВ\n\nтЪая╕П рдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╕рд╣рд╛рдпрддрд╛ рд▓реЗрдВ рдпрджрд┐:\nтАв рд╣реГрджрдп рдЧрддрд┐ 120 BPM рд╕реЗ рдКрдкрд░ рд░рд╣рддреА рд╣реИ\nтАв рдЫрд╛рддреА рдореЗрдВ рджрд░реНрдж рдпрд╛ рджрдмрд╛рд╡\nтАв рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдореЗрдВ рдХрдард┐рдирд╛рдИ\nтАв рдЪрдХреНрдХрд░ рдЖрдирд╛ рдпрд╛ рдмреЗрд╣реЛрд╢реА'
  },
  {
    keyword: ['air', 'toxicity', 'gas', 'breathing', 'toxic', 'poisonous', 'oxygen', 'рд╡рд╛рдпреБ', 'рдЧреИрд╕', 'рд╕рд╛рдВрд╕', 'рд╡рд┐рд╖рд╛рдХреНрдд', 'рдЬрд╣рд░реАрд▓рд╛'],
    responseEn: 'тШгя╕П HIGH AIR TOXICITY EMERGENCY:\n\n1. PUT ON your oxygen mask/respirator IMMEDIATELY\n2. ALERT everyone nearby - shout "GAS ALERT!"\n3. Move to fresh air zone or evacuation route\n4. Do NOT run - move quickly but steadily\n5. Help others who may be affected\n6. Report to control room via emergency radio\n7. Do NOT remove mask until in safe zone\n\nтЪая╕П SYMPTOMS OF GAS POISONING:\nтАв Dizziness or headache\nтАв Nausea or vomiting\nтАв Confusion or disorientation\nтАв Rapid breathing\nтАв Chest tightness\n\nЁЯЪи EVACUATION REQUIRED if toxicity >20 PPM',
    responseHi: 'тШгя╕П рдЙрдЪреНрдЪ рд╡рд╛рдпреБ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдЖрдкрд╛рддрдХрд╛рд▓:\n\n1. рддреБрд░рдВрдд рдЕрдкрдирд╛ рдСрдХреНрд╕реАрдЬрди рдорд╛рд╕реНрдХ/рд░реЗрд╕реНрдкрд┐рд░реЗрдЯрд░ рдкрд╣рдиреЗрдВ\n2. рдЖрд╕-рдкрд╛рд╕ рдХреЗ рд╕рднреА рд▓реЛрдЧреЛрдВ рдХреЛ рд╕рдЪреЗрдд рдХрд░реЗрдВ - "рдЧреИрд╕ рдЕрд▓рд░реНрдЯ!" рдЪрд┐рд▓реНрд▓рд╛рдПрдВ\n3. рддрд╛рдЬреА рд╣рд╡рд╛ рдХреНрд╖реЗрддреНрд░ рдпрд╛ рдирд┐рдХрд╛рд╕реА рдорд╛рд░реНрдЧ рдХреА рдУрд░ рдмрдврд╝реЗрдВ\n4. рди рднрд╛рдЧреЗрдВ - рддреЗрдЬреА рд╕реЗ рд▓реЗрдХрд┐рди рд╕реНрдерд┐рд░ рд░реВрдк рд╕реЗ рдЪрд▓реЗрдВ\n5. рдкреНрд░рднрд╛рд╡рд┐рдд рдЕрдиреНрдп рд▓реЛрдЧреЛрдВ рдХреА рдорджрдж рдХрд░реЗрдВ\n6. рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд░реЗрдбрд┐рдпреЛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖ рдХреЛ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдВ\n7. рд╕реБрд░рдХреНрд╖рд┐рдд рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЖрдиреЗ рддрдХ рдорд╛рд╕реНрдХ рди рд╣рдЯрд╛рдПрдВ\n\nтЪая╕П рдЧреИрд╕ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдХреЗ рд▓рдХреНрд╖рдг:\nтАв рдЪрдХреНрдХрд░ рдЖрдирд╛ рдпрд╛ рд╕рд┐рд░рджрд░реНрдж\nтАв рдорддрд▓реА рдпрд╛ рдЙрд▓реНрдЯреА\nтАв рднреНрд░рдо рдпрд╛ рджрд┐рд╢рд╛рд╣реАрдирддрд╛\nтАв рддреЗрдЬ рд╕рд╛рдВрд╕ рд▓реЗрдирд╛\nтАв рдЫрд╛рддреА рдореЗрдВ рдЬрдХрдбрд╝рди\n\nЁЯЪи 20 PPM рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рдкрд░ рдирд┐рдХрд╛рд╕реА рдЖрд╡рд╢реНрдпрдХ'
  },
  {
    keyword: ['temperature', 'heat', 'hot', 'cold', 'fever', 'рддрд╛рдкрдорд╛рди', 'рдЧрд░реНрдореА', 'рдардВрдб', 'рдмреБрдЦрд╛рд░'],
    responseEn: 'ЁЯМбя╕П TEMPERATURE EMERGENCY:\n\nFOR HIGH TEMPERATURE (>35┬░C):\n1. Move to cooler area immediately\n2. Remove excess clothing/equipment if safe\n3. Drink water slowly (not too fast)\n4. Wet cloth on forehead, neck, wrists\n5. Rest in shade or ventilated area\n6. Monitor for heat exhaustion signs\n\nFOR LOW TEMPERATURE (<15┬░C):\n1. Move to warmer area\n2. Add layers of clothing\n3. Drink warm (not hot) liquids\n4. Keep moving to generate warmth\n5. Cover head and extremities\n\nтЪая╕П WARNING SIGNS:\nтАв Excessive sweating or no sweating\nтАв Confusion or slurred speech\nтАв Rapid pulse\nтАв Severe shivering\nтАв Loss of coordination',
    responseHi: 'ЁЯМбя╕П рддрд╛рдкрдорд╛рди рдЖрдкрд╛рддрдХрд╛рд▓:\n\nрдЙрдЪреНрдЪ рддрд╛рдкрдорд╛рди рдХреЗ рд▓рд┐рдП (>35┬░C):\n1. рддреБрд░рдВрдд рдардВрдбреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЬрд╛рдПрдВ\n2. рдпрджрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ рддреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдкрдбрд╝реЗ/рдЙрдкрдХрд░рдг рд╣рдЯрд╛рдПрдВ\n3. рдзреАрд░реЗ-рдзреАрд░реЗ рдкрд╛рдиреА рдкрд┐рдПрдВ (рдмрд╣реБрдд рддреЗрдЬ рдирд╣реАрдВ)\n4. рдорд╛рдереЗ, рдЧрд░реНрджрди, рдХрд▓рд╛рдИ рдкрд░ рдЧреАрд▓рд╛ рдХрдкрдбрд╝рд╛ рд░рдЦреЗрдВ\n5. рдЫрд╛рдпрд╛ рдпрд╛ рд╣рд╡рд╛рджрд╛рд░ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЖрд░рд╛рдо рдХрд░реЗрдВ\n6. рдЧрд░реНрдореА рдХреА рдердХрд╛рд╡рдЯ рдХреЗ рд▓рдХреНрд╖рдгреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ\n\nрдХрдо рддрд╛рдкрдорд╛рди рдХреЗ рд▓рд┐рдП (<15┬░C):\n1. рдЧрд░реНрдо рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЬрд╛рдПрдВ\n2. рдХрдкрдбрд╝реЛрдВ рдХреА рдкрд░рддреЗрдВ рдЬреЛрдбрд╝реЗрдВ\n3. рдЧрд░реНрдо (рдЧрд░рдо рдирд╣реАрдВ) рддрд░рд▓ рдкрджрд╛рд░реНрде рдкрд┐рдПрдВ\n4. рдЧрд░реНрдореА рдкреИрджрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рддреЗ рд░рд╣реЗрдВ\n5. рд╕рд┐рд░ рдФрд░ рдЕрдВрдЧреЛрдВ рдХреЛ рдврдХреЗрдВ\n\nтЪая╕П рдЪреЗрддрд╛рд╡рдиреА рд╕рдВрдХреЗрдд:\nтАв рдЕрддреНрдпрдзрд┐рдХ рдкрд╕реАрдирд╛ рдпрд╛ рдмрд┐рд▓реНрдХреБрд▓ рдкрд╕реАрдирд╛ рдирд╣реАрдВ\nтАв рднреНрд░рдо рдпрд╛ рдЕрд╕реНрдкрд╖реНрдЯ рднрд╛рд╖рдг\nтАв рддреЗрдЬ рдирд╛рдбрд╝реА\nтАв рдЧрдВрднреАрд░ рдХрдВрдкрдХрдВрдкреА\nтАв рд╕рдордиреНрд╡рдп рдХреА рд╣рд╛рдирд┐'
  },
  {
    keyword: ['emergency', 'help', 'danger', 'accident', 'injured', 'hurt', 'рдЖрдкрд╛рддрдХрд╛рд▓', 'рдорджрдж', 'рдЦрддрд░рд╛', 'рджреБрд░реНрдШрдЯрдирд╛', 'рдШрд╛рдпрд▓'],
    responseEn: 'ЁЯЪи GENERAL EMERGENCY PROCEDURE:\n\n1. STAY CALM - panic causes mistakes\n2. ASSESS the situation:\n   тАв Are you in immediate danger?\n   тАв Can you move safely?\n   тАв Are others affected?\n\n3. ACTIVATE emergency alert:\n   тАв Press emergency button\n   тАв Radio: "EMERGENCY at [location]"\n   тАв Sound alarm if available\n\n4. EVACUATE if necessary:\n   тАв Use marked emergency routes\n   тАв Help injured if safe to do so\n   тАв Don\'t use elevators\n   тАв Stay low if smoke present\n\n5. MUSTER at designated assembly point\n\n6. WAIT for emergency responders\n\nЁЯУЮ Emergency Contact: Control Room\nЁЯЧ║я╕П Know your nearest emergency exit!',
    responseHi: 'ЁЯЪи рд╕рд╛рдорд╛рдиреНрдп рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдкреНрд░рдХреНрд░рд┐рдпрд╛:\n\n1. рд╢рд╛рдВрдд рд░рд╣реЗрдВ - рдШрдмрд░рд╛рд╣рдЯ рд╕реЗ рдЧрд▓рддрд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВ\n2. рд╕реНрдерд┐рддрд┐ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдВ:\n   тАв рдХреНрдпрд╛ рдЖрдк рддрддреНрдХрд╛рд▓ рдЦрддрд░реЗ рдореЗрдВ рд╣реИрдВ?\n   тАв рдХреНрдпрд╛ рдЖрдк рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ?\n   тАв рдХреНрдпрд╛ рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реИрдВ?\n\n3. рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЕрд▓рд░реНрдЯ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ:\n   тАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдмрдЯрди рджрдмрд╛рдПрдВ\n   тАв рд░реЗрдбрд┐рдпреЛ: "[рд╕реНрдерд╛рди] рдкрд░ рдЖрдкрд╛рддрдХрд╛рд▓"\n   тАв рдпрджрд┐ рдЙрдкрд▓рдмреНрдз рд╣реЛ рддреЛ рдЕрд▓рд╛рд░реНрдо рдмрдЬрд╛рдПрдВ\n\n4. рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдирд┐рдХрд▓реЗрдВ:\n   тАв рдЪрд┐рд╣реНрдирд┐рдд рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдорд╛рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n   тАв рдпрджрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ рддреЛ рдШрд╛рдпрд▓реЛрдВ рдХреА рдорджрдж рдХрд░реЗрдВ\n   тАв рд▓рд┐рдлреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ\n   тАв рдзреБрдЖрдВ рд╣реЛрдиреЗ рдкрд░ рдиреАрдЪреЗ рд░рд╣реЗрдВ\n\n5. рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕рднрд╛ рдмрд┐рдВрджреБ рдкрд░ рдЬрдорд╛ рд╣реЛрдВ\n\n6. рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЙрддреНрддрд░рджрд╛рддрд╛рдУрдВ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ\n\nЁЯУЮ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕рдВрдкрд░реНрдХ: рдирд┐рдпрдВрддреНрд░рдг рдХрдХреНрд╖\nЁЯЧ║я╕П рдЕрдкрдиреЗ рдирд┐рдХрдЯрддрдо рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдирд┐рдХрд╛рд╕ рдХреЛ рдЬрд╛рдиреЗрдВ!'
  },
  {
    keyword: ['equipment', 'gear', 'safety', 'protective', 'mask', 'helmet', 'рдЙрдкрдХрд░рдг', 'рд╕реБрд░рдХреНрд╖рд╛', 'рдорд╛рд╕реНрдХ', 'рд╣реЗрд▓рдореЗрдЯ'],
    responseEn: 'ЁЯЫбя╕П ESSENTIAL SAFETY EQUIPMENT:\n\nтЬУ MUST WEAR AT ALL TIMES:\n1. Hard hat/helmet - protects head\n2. Safety boots - steel toe protection\n3. High-visibility vest - be seen\n4. Headlamp - hands-free lighting\n5. Personal alarm - emergency alert\n\nтЬУ BREATHING PROTECTION:\nтАв N95 mask for dust\nтАв Full respirator for gas zones\nтАв Self-contained breathing apparatus (SCBA) for emergencies\n\nтЬУ PERSONAL MONITORING:\nтАв Gas detector badge\nтАв Heart rate monitor\nтАв GPS tracker\n\nтЬУ COMMUNICATION:\nтАв Two-way radio\nтАв Whistle\nтАв Emergency beacon\n\nЁЯУЛ DAILY CHECK:\nInspect all equipment before shift. Report damaged equipment immediately!',
    responseHi: 'ЁЯЫбя╕П рдЖрд╡рд╢реНрдпрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг:\n\nтЬУ рд╣рд░ рд╕рдордп рдкрд╣рдирдирд╛ рдЕрдирд┐рд╡рд╛рд░реНрдп:\n1. рд╣рд╛рд░реНрдб рд╣реИрдЯ/рд╣реЗрд▓рдореЗрдЯ - рд╕рд┐рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛\n2. рд╕реБрд░рдХреНрд╖рд╛ рдЬреВрддреЗ - рд╕реНрдЯреАрд▓ рдЯреЛ рд╕реБрд░рдХреНрд╖рд╛\n3. рдЙрдЪреНрдЪ рджреГрд╢реНрдпрддрд╛ рдмрдирд┐рдпрд╛рди - рджрд┐рдЦрд╛рдИ рджреЗрдВ\n4. рд╣реЗрдбрд▓реИрдВрдк - рд╣рд╛рде-рдореБрдХреНрдд рдкреНрд░рдХрд╛рд╢\n5. рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЕрд▓рд╛рд░реНрдо - рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдЪреЗрддрд╛рд╡рдиреА\n\nтЬУ рд╕рд╛рдВрд╕ рдХреА рд╕реБрд░рдХреНрд╖рд╛:\nтАв рдзреВрд▓ рдХреЗ рд▓рд┐рдП N95 рдорд╛рд╕реНрдХ\nтАв рдЧреИрд╕ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг рд╢реНрд╡рд╛рд╕рдпрдВрддреНрд░\nтАв рдЖрдкрд╛рдд рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рд╕реНрд╡-рдирд┐рд╣рд┐рдд рд╢реНрд╡рд╛рд╕ рддрдВрддреНрд░ (SCBA)\n\nтЬУ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдирд┐рдЧрд░рд╛рдиреА:\nтАв рдЧреИрд╕ рдбрд┐рдЯреЗрдХреНрдЯрд░ рдмреИрдЬ\nтАв рд╣реГрджрдп рдЧрддрд┐ рдореЙрдирд┐рдЯрд░\nтАв GPS рдЯреНрд░реИрдХрд░\n\nтЬУ рд╕рдВрдЪрд╛рд░:\nтАв рджреЛ-рддрд░рдлрд╛ рд░реЗрдбрд┐рдпреЛ\nтАв рд╕реАрдЯреА\nтАв рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдмреАрдХрди\n\nЁЯУЛ рджреИрдирд┐рдХ рдЬрд╛рдВрдЪ:\nрд╢рд┐рдлреНрдЯ рд╕реЗ рдкрд╣рд▓реЗ рд╕рднреА рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░реЗрдВред рдХреНрд╖рддрд┐рдЧреНрд░рд╕реНрдд рдЙрдкрдХрд░рдг рдХреА рддреБрд░рдВрдд рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдВ!'
  },
  {
    keyword: ['collapse', 'roof fall', 'cave in', 'trapped', 'stuck', 'рдЧрд┐рд░рдирд╛', 'рдлрдВрд╕рдирд╛', 'рдзрдВрд╕рдирд╛'],
    responseEn: 'тЪая╕П ROOF COLLAPSE / CAVE-IN EMERGENCY:\n\nIF YOU ARE TRAPPED:\n1. Stay calm - conserve oxygen\n2. Check for injuries\n3. Make noise periodically (knock on pipes/rocks)\n4. Use whistle if you have one\n5. Activate emergency beacon\n6. If possible, move to safer location\n7. Cover mouth/nose to filter dust\n8. Conserve phone/radio battery\n\nIF OTHERS ARE TRAPPED:\n1. DO NOT enter unstable area alone\n2. Alert rescue team immediately\n3. Mark location clearly\n4. Provide information about trapped miners\n5. Keep communication line open\n6. Wait for professional rescue team\n\nЁЯЖШ Stay visible, stay vocal, stay alive!\nRescue teams WILL find you!',
    responseHi: 'тЪая╕П рдЫрдд рдЧрд┐рд░рдиреЗ / рдзрдВрд╕рдиреЗ рдХреА рдЖрдкрд╛рдд рд╕реНрдерд┐рддрд┐:\n\nрдпрджрд┐ рдЖрдк рдлрдВрд╕ рдЧрдП рд╣реИрдВ:\n1. рд╢рд╛рдВрдд рд░рд╣реЗрдВ - рдСрдХреНрд╕реАрдЬрди рдмрдЪрд╛рдПрдВ\n2. рдЪреЛрдЯреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ\n3. рд╕рдордп-рд╕рдордп рдкрд░ рд╢реЛрд░ рдХрд░реЗрдВ (рдкрд╛рдЗрдк/рдкрддреНрдерд░ рдкрд░ рджрд╕реНрддрдХ рджреЗрдВ)\n4. рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕реАрдЯреА рд╣реИ рддреЛ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n5. рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдмреАрдХрди рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ\n6. рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реНрдерд╛рди рдкрд░ рдЬрд╛рдПрдВ\n7. рдзреВрд▓ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдВрд╣/рдирд╛рдХ рдХреЛ рдврдХреЗрдВ\n8. рдлреЛрди/рд░реЗрдбрд┐рдпреЛ рдмреИрдЯрд░реА рдмрдЪрд╛рдПрдВ\n\nрдпрджрд┐ рдЕрдиреНрдп рдлрдВрд╕реЗ рд╣реИрдВ:\n1. рдЕрдХреЗрд▓реЗ рдЕрд╕реНрдерд┐рд░ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рди рдХрд░реЗрдВ\n2. рддреБрд░рдВрдд рдмрдЪрд╛рд╡ рджрд▓ рдХреЛ рд╕рддрд░реНрдХ рдХрд░реЗрдВ\n3. рд╕реНрдерд╛рди рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ\n4. рдлрдВрд╕реЗ рдЦрдирд┐рдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░реЗрдВ\n5. рд╕рдВрдЪрд╛рд░ рд▓рд╛рдЗрди рдЦреБрд▓реА рд░рдЦреЗрдВ\n6. рдкреЗрд╢реЗрд╡рд░ рдмрдЪрд╛рд╡ рджрд▓ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ\n\nЁЯЖШ рджрд┐рдЦрд╛рдИ рджреЗрдВ, рдЖрд╡рд╛рдЬ рджреЗрдВ, рдЬреАрд╡рд┐рдд рд░рд╣реЗрдВ!\nрдмрдЪрд╛рд╡ рджрд▓ рдЖрдкрдХреЛ рдвреВрдВрдв рд▓реЗрдВрдЧреЗ!'
  },
  {
    keyword: ['fire', 'smoke', 'burning', 'flames', 'рдЖрдЧ', 'рдзреБрдЖрдВ', 'рдЬрд▓рдирд╛'],
    responseEn: 'ЁЯФе FIRE EMERGENCY:\n\n1. SOUND THE ALARM immediately\n2. EVACUATE - don\'t fight large fires\n3. Stay LOW - smoke rises, clean air is below\n4. Touch doors before opening (hot = fire behind)\n5. Close doors behind you (contain fire)\n6. Use EMERGENCY EXITS only\n7. DO NOT use elevators\n8. Proceed to assembly point\n\nIF SMALL FIRE:\nтАв Use fire extinguisher (PASS method):\n  P - Pull pin\n  A - Aim at base of fire\n  S - Squeeze handle\n  S - Sweep side to side\n\nIF CLOTHES ON FIRE:\nтАв STOP - don\'t run\nтАв DROP - to ground\nтАв ROLL - back and forth to smother flames\n\nтШБя╕П If trapped by smoke:\nтАв Seal door gaps with cloth\nтАв Signal from window/opening\nтАв Stay low to ground',
    responseHi: 'ЁЯФе рдЕрдЧреНрдирд┐ рдЖрдкрд╛рддрдХрд╛рд▓:\n\n1. рддреБрд░рдВрдд рдЕрд▓рд╛рд░реНрдо рдмрдЬрд╛рдПрдВ\n2. рдирд┐рдХрд▓реЗрдВ - рдмрдбрд╝реА рдЖрдЧ рд╕реЗ рди рд▓рдбрд╝реЗрдВ\n3. рдиреАрдЪреЗ рд░рд╣реЗрдВ - рдзреБрдЖрдВ рдКрдкрд░ рдЙрдарддрд╛ рд╣реИ, рд╕реНрд╡рдЪреНрдЫ рд╣рд╡рд╛ рдиреАрдЪреЗ рд╣реИ\n4. рдЦреЛрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджрд░рд╡рд╛рдЬреЗ рдЫреБрдПрдВ (рдЧрд░реНрдо = рдкреАрдЫреЗ рдЖрдЧ)\n5. рдЕрдкрдиреЗ рдкреАрдЫреЗ рджрд░рд╡рд╛рдЬреЗ рдмрдВрдж рдХрд░реЗрдВ (рдЖрдЧ рдХреЛ рд░реЛрдХреЗрдВ)\n6. рдХреЗрд╡рд▓ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдирд┐рдХрд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n7. рд▓рд┐рдлреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ\n8. рд╕рднрд╛ рдмрд┐рдВрджреБ рдХреА рдУрд░ рдмрдврд╝реЗрдВ\n\nрдпрджрд┐ рдЫреЛрдЯреА рдЖрдЧ:\nтАв рдЕрдЧреНрдирд┐рд╢рд╛рдордХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (PASS рд╡рд┐рдзрд┐):\n  P - рдкрд┐рди рдЦреАрдВрдЪреЗрдВ\n  A - рдЖрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рдХреНрд╖реНрдп рд░рдЦреЗрдВ\n  S - рд╣реИрдВрдбрд▓ рдирд┐рдЪреЛрдбрд╝реЗрдВ\n  S - рдПрдХ рддрд░рдл рд╕реЗ рджреВрд╕рд░реА рддрд░рдл рдШреБрдорд╛рдПрдВ\n\nрдпрджрд┐ рдХрдкрдбрд╝реЛрдВ рдореЗрдВ рдЖрдЧ:\nтАв рд░реБрдХреЗрдВ - рди рднрд╛рдЧреЗрдВ\nтАв рдЧрд┐рд░реЗрдВ - рдЬрдореАрди рдкрд░\nтАв рд▓реБрдврд╝рдХреЗрдВ - рдЖрдЧреЗ рдкреАрдЫреЗ рд▓рдкрдЯреЛрдВ рдХреЛ рдмреБрдЭрд╛рдиреЗ рдХреЗ рд▓рд┐рдП\n\nтШБя╕П рдпрджрд┐ рдзреБрдПрдВ рд╕реЗ рдлрдВрд╕ рдЧрдП:\nтАв рдХрдкрдбрд╝реЗ рд╕реЗ рджрд░рд╡рд╛рдЬреЗ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдмрдВрдж рдХрд░реЗрдВ\nтАв рдЦрд┐рдбрд╝рдХреА/рдЦреБрд▓рдиреЗ рд╕реЗ рд╕рдВрдХреЗрдд рджреЗрдВ\nтАв рдЬрдореАрди рдХреЗ рдкрд╛рд╕ рд░рд╣реЗрдВ'
  },
  {
    keyword: ['water', 'flood', 'wet', 'drowning', 'рдкрд╛рдиреА', 'рдмрд╛рдврд╝', 'рдбреВрдмрдирд╛'],
    responseEn: 'ЁЯТз WATER/FLOODING EMERGENCY:\n\n1. EVACUATE to higher ground immediately\n2. DO NOT walk through moving water\n3. Turn off electrical equipment if safe\n4. Alert others via radio/alarm\n5. Use designated flood escape routes\n6. Avoid flooded shafts and tunnels\n\nIF WATER IS RISING:\nтАв Move upward quickly but carefully\nтАв Don\'t try to save equipment\nтАв Help others who need assistance\nтАв Account for all team members\n\nWATER SAFETY:\nтАв Never enter unknown water depths\nтАв Flowing water is dangerous (even shallow)\nтАв Watch for electrical hazards\nтАв Be aware of slip hazards\n\nЁЯЪи Even 6 inches of moving water can knock you down!\n\nтЪб ELECTROCUTION RISK in flooded areas with power!',
    responseHi: 'ЁЯТз рдкрд╛рдиреА/рдмрд╛рдврд╝ рдЖрдкрд╛рддрдХрд╛рд▓:\n\n1. рддреБрд░рдВрдд рдКрдВрдЪреА рдЬрдЧрд╣ рдкрд░ рдирд┐рдХрд▓реЗрдВ\n2. рдмрд╣рддреЗ рдкрд╛рдиреА рдореЗрдВ рди рдЪрд▓реЗрдВ\n3. рдпрджрд┐ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ рддреЛ рд╡рд┐рджреНрдпреБрдд рдЙрдкрдХрд░рдг рдмрдВрдж рдХрд░реЗрдВ\n4. рд░реЗрдбрд┐рдпреЛ/рдЕрд▓рд╛рд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреВрд╕рд░реЛрдВ рдХреЛ рд╕рддрд░реНрдХ рдХрд░реЗрдВ\n5. рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдмрд╛рдврд╝ рдирд┐рдХрд╛рд╕реА рдорд╛рд░реНрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ\n6. рдмрд╛рдврд╝рдЧреНрд░рд╕реНрдд рд╢рд╛рдлреНрдЯ рдФрд░ рд╕реБрд░рдВрдЧреЛрдВ рд╕реЗ рдмрдЪреЗрдВ\n\nрдпрджрд┐ рдкрд╛рдиреА рдмрдврд╝ рд░рд╣рд╛ рд╣реИ:\nтАв рддреЗрдЬреА рд╕реЗ рд▓реЗрдХрд┐рди рд╕рд╛рд╡рдзрд╛рдиреА рд╕реЗ рдКрдкрд░ рдЬрд╛рдПрдВ\nтАв рдЙрдкрдХрд░рдг рдмрдЪрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рди рдХрд░реЗрдВ\nтАв рд╕рд╣рд╛рдпрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╡рд╛рд▓реЗ рдЕрдиреНрдп рд▓реЛрдЧреЛрдВ рдХреА рдорджрдж рдХрд░реЗрдВ\nтАв рд╕рднреА рдЯреАрдо рд╕рджрд╕реНрдпреЛрдВ рдХрд╛ рд╣рд┐рд╕рд╛рдм рд░рдЦреЗрдВ\n\nрдкрд╛рдиреА рд╕реБрд░рдХреНрд╖рд╛:\nтАв рдЕрдЬреНрдЮрд╛рдд рдкрд╛рдиреА рдХреА рдЧрд╣рд░рд╛рдИ рдореЗрдВ рдХрднреА рди рдЬрд╛рдПрдВ\nтАв рдмрд╣рддрд╛ рдкрд╛рдиреА рдЦрддрд░рдирд╛рдХ рд╣реИ (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЙрдерд▓рд╛ рднреА)\nтАв рд╡рд┐рджреНрдпреБрдд рдЦрддрд░реЛрдВ рд╕реЗ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ\nтАв рдлрд┐рд╕рд▓рди рдЦрддрд░реЛрдВ рд╕реЗ рдЕрд╡рдЧрдд рд░рд╣реЗрдВ\n\nЁЯЪи 6 рдЗрдВрдЪ рдмрд╣рддрд╛ рдкрд╛рдиреА рднреА рдЖрдкрдХреЛ рдЧрд┐рд░рд╛ рд╕рдХрддрд╛ рд╣реИ!\n\nтЪб рдмрд┐рдЬрд▓реА рд╡рд╛рд▓реЗ рдмрд╛рдврд╝рдЧреНрд░рд╕реНрдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдмрд┐рдЬрд▓реА рдХрд╛ рдЭрдЯрдХрд╛ рдЬреЛрдЦрд┐рдо!'
  },
  {
    keyword: ['first aid', 'injury', 'bleeding', 'wound', 'cut', 'рдкреНрд░рд╛рдердорд┐рдХ рдЪрд┐рдХрд┐рддреНрд╕рд╛', 'рдЪреЛрдЯ', 'рдЦреВрди рдмрд╣рдирд╛', 'рдШрд╛рд╡'],
    responseEn: 'ЁЯПе BASIC FIRST AID:\n\nFOR BLEEDING:\n1. Apply direct pressure with clean cloth\n2. Elevate wounded area above heart\n3. Maintain pressure for 10-15 minutes\n4. Apply bandage firmly but not too tight\n5. Seek medical help if severe\n\nFOR BURNS:\n1. Remove from heat source\n2. Cool with water (not ice) for 10 minutes\n3. Cover with clean, dry dressing\n4. Do NOT apply ointments/butter\n5. Seek medical attention\n\nFOR FRACTURES:\n1. Don\'t move injured person unnecessarily\n2. Immobilize the injured area\n3. Apply ice pack if available\n4. Call for medical assistance\n\nFOR UNCONSCIOUSNESS:\n1. Check breathing and pulse\n2. Place in recovery position if breathing\n3. Start CPR if not breathing\n4. Call emergency services\n\nтЪХя╕П Remember: Your safety first!\nDon\'t become a victim while helping!',
    responseHi: 'ЁЯПе рдмреБрдирд┐рдпрд╛рджреА рдкреНрд░рд╛рдердорд┐рдХ рдЪрд┐рдХрд┐рддреНрд╕рд╛:\n\nрдЦреВрди рдмрд╣рдиреЗ рдХреЗ рд▓рд┐рдП:\n1. рд╕рд╛рдл рдХрдкрдбрд╝реЗ рд╕реЗ рд╕реАрдзрд╛ рджрдмрд╛рд╡ рд▓рдЧрд╛рдПрдВ\n2. рдШрд╛рдпрд▓ рдХреНрд╖реЗрддреНрд░ рдХреЛ рд╣реГрджрдп рд╕реЗ рдКрдкрд░ рдЙрдард╛рдПрдВ\n3. 10-15 рдорд┐рдирдЯ рддрдХ рджрдмрд╛рд╡ рдмрдирд╛рдП рд░рдЦреЗрдВ\n4. рдкрдЯреНрдЯреА рдордЬрдмреВрддреА рд╕реЗ рд▓рдЧрд╛рдПрдВ рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдХрд╕рдХрд░ рдирд╣реАрдВ\n5. рдпрджрд┐ рдЧрдВрднреАрд░ рд╣реЛ рддреЛ рдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╕рд╣рд╛рдпрддрд╛ рд▓реЗрдВ\n\nрдЬрд▓рдиреЗ рдХреЗ рд▓рд┐рдП:\n1. рдЧрд░реНрдореА рд╕реНрд░реЛрдд рд╕реЗ рд╣рдЯрд╛рдПрдВ\n2. 10 рдорд┐рдирдЯ рдХреЗ рд▓рд┐рдП рдкрд╛рдиреА (рдмрд░реНрдл рдирд╣реАрдВ) рд╕реЗ рдардВрдбрд╛ рдХрд░реЗрдВ\n3. рд╕рд╛рдл, рд╕реВрдЦреА рдбреНрд░реЗрд╕рд┐рдВрдЧ рд╕реЗ рдврдХреЗрдВ\n4. рдорд▓рд╣рдо/рдордХреНрдЦрди рди рд▓рдЧрд╛рдПрдВ\n5. рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдзреНрдпрд╛рди рд▓реЗрдВ\n\nрдлреНрд░реИрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП:\n1. рдШрд╛рдпрд▓ рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд░реВрдк рд╕реЗ рди рд╣рд┐рд▓рд╛рдПрдВ\n2. рдШрд╛рдпрд▓ рдХреНрд╖реЗрддреНрд░ рдХреЛ рд╕реНрдерд┐рд░ рдХрд░реЗрдВ\n3. рдпрджрд┐ рдЙрдкрд▓рдмреНрдз рд╣реЛ рддреЛ рдЖрдЗрд╕ рдкреИрдХ рд▓рдЧрд╛рдПрдВ\n4. рдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░реЗрдВ\n\nрдмреЗрд╣реЛрд╢реА рдХреЗ рд▓рд┐рдП:\n1. рд╕рд╛рдВрд╕ рдФрд░ рдирд╛рдбрд╝реА рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ\n2. рдпрджрд┐ рд╕рд╛рдВрд╕ рд▓реЗ рд░рд╣рд╛ рд╣реИ рддреЛ рд░рд┐рдХрд╡рд░реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд░рдЦреЗрдВ\n3. рдпрджрд┐ рд╕рд╛рдВрд╕ рдирд╣реАрдВ рд▓реЗ рд░рд╣рд╛ рд╣реИ рддреЛ CPR рд╢реБрд░реВ рдХрд░реЗрдВ\n4. рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ\n\nтЪХя╕П рдпрд╛рдж рд░рдЦреЗрдВ: рдкрд╣рд▓реЗ рдЖрдкрдХреА рд╕реБрд░рдХреНрд╖рд╛!\nрдорджрдж рдХрд░рддреЗ рд╕рдордп рдкреАрдбрд╝рд┐рдд рди рдмрдиреЗрдВ!'
  }
];

export default function SafetyChatbot() {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState<Message[]>([]);
  const [inputText, setInputText] = useState('');
  const [language, setLanguage] = useState<'en' | 'hi'>('en');
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  useEffect(() => {
    if (isOpen && messages.length === 0) {
      const welcomeMessage: Message = {
        id: Date.now().toString(),
        text: language === 'en'
          ? 'Hello! I am your mining safety assistant. I can provide emergency tips and safety guidance. Type "hello" to see what I can help with!'
          : 'рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ рдЦрдирди рд╕реБрд░рдХреНрд╖рд╛ рд╕рд╣рд╛рдпрдХ рд╣реВрдВред рдореИрдВ рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реБрдЭрд╛рд╡ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред "hello" рдЯрд╛рдЗрдк рдХрд░реЗрдВ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВ рдХрд┐рд╕рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ!',
        sender: 'bot',
        timestamp: new Date()
      };
      setMessages([welcomeMessage]);
    }
  }, [isOpen, language]);

  const findResponse = (userInput: string): string => {
    const lowerInput = userInput.toLowerCase();

    for (const tip of safetyTips) {
      for (const keyword of tip.keyword) {
        if (lowerInput.includes(keyword.toLowerCase())) {
          return language === 'en' ? tip.responseEn : tip.responseHi;
        }
      }
    }

    return language === 'en'
      ? 'I can help with:\nтАв Heart rate emergencies\nтАв Air toxicity issues\nтАв Temperature problems\nтАв General emergencies\nтАв Safety equipment\nтАв First aid\nтАв Fire safety\nтАв Water/flooding\nтАв Cave-ins\n\nPlease ask about any of these topics!'
      : 'рдореИрдВ рдЗрд╕рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ:\nтАв рд╣реГрджрдп рдЧрддрд┐ рдЖрдкрд╛рдд рд╕реНрдерд┐рддрд┐\nтАв рд╡рд╛рдпреБ рд╡рд┐рд╖рд╛рдХреНрддрддрд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ\nтАв рддрд╛рдкрдорд╛рди рд╕рдорд╕реНрдпрд╛рдПрдВ\nтАв рд╕рд╛рдорд╛рдиреНрдп рдЖрдкрд╛рдд рд╕реНрдерд┐рддрд┐\nтАв рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг\nтАв рдкреНрд░рд╛рдердорд┐рдХ рдЪрд┐рдХрд┐рддреНрд╕рд╛\nтАв рдЕрдЧреНрдирд┐ рд╕реБрд░рдХреНрд╖рд╛\nтАв рдкрд╛рдиреА/рдмрд╛рдврд╝\nтАв рдзрдВрд╕рдирд╛\n\nрдХреГрдкрдпрд╛ рдЗрди рд╡рд┐рд╖рдпреЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВ!';
  };

  const handleSend = () => {
    if (!inputText.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);

    setTimeout(() => {
      const botResponse = findResponse(inputText);
      const botMessage: Message = {
        id: (Date.now() + 1).toString(),
        text: botResponse,
        sender: 'bot',
        timestamp: new Date()
      };
      setMessages(prev => [...prev, botMessage]);
    }, 500);

    setInputText('');
  };

  const handleKeyPress = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const toggleLanguage = () => {
    setLanguage(prev => prev === 'en' ? 'hi' : 'en');
    const langMessage: Message = {
      id: Date.now().toString(),
      text: language === 'en'
        ? 'рднрд╛рд╖рд╛ рд╣рд┐рдВрджреА рдореЗрдВ рдмрджрд▓ рдЧрдИред рдореИрдВ рдЕрдм рд╣рд┐рдВрджреА рдореЗрдВ рдЬрд╡рд╛рдм рджреВрдВрдЧрд╛!'
        : 'Language changed to English. I will now respond in English!',
      sender: 'bot',
      timestamp: new Date()
    };
    setMessages(prev => [...prev, langMessage]);
  };

  return (
    <>
      {!isOpen && (
        <button
          onClick={() => setIsOpen(true)}
          className="fixed bottom-6 right-6 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-full p-4 shadow-2xl hover:shadow-3xl transition-all hover:scale-110 z-50 group"
          aria-label="Open safety chatbot"
        >
          <MessageSquare className="w-7 h-7" />
          <span className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse"></span>
          <div className="absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
            {language === 'en' ? 'Safety Assistant' : 'рд╕реБрд░рдХреНрд╖рд╛ рд╕рд╣рд╛рдпрдХ'}
          </div>
        </button>
      )}

      {isOpen && (
        <div className="fixed bottom-6 right-6 w-96 h-[600px] bg-white rounded-2xl shadow-2xl flex flex-col z-50 border-2 border-amber-500">
          <div className="bg-gradient-to-r from-amber-500 to-orange-600 text-white p-4 rounded-t-2xl flex items-center justify-between">
            <div className="flex items-center gap-3">
              <Shield className="w-6 h-6" />
              <div>
                <h3 className="font-bold text-lg">
                  {language === 'en' ? 'Safety Assistant' : 'рд╕реБрд░рдХреНрд╖рд╛ рд╕рд╣рд╛рдпрдХ'}
                </h3>
                <p className="text-xs opacity-90">
                  {language === 'en' ? 'Emergency tips & guidance' : 'рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕реБрдЭрд╛рд╡ рдФрд░ рдорд╛рд░реНрдЧрджрд░реНрд╢рди'}
                </p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={toggleLanguage}
                className="p-2 hover:bg-white/20 rounded-lg transition-colors"
                title={language === 'en' ? 'Switch to Hindi' : 'рдЕрдВрдЧреНрд░реЗрдЬреА рдореЗрдВ рдмрджрд▓реЗрдВ'}
              >
                <Languages className="w-5 h-5" />
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="p-2 hover:bg-white/20 rounded-lg transition-colors"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>

          <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-gradient-to-b from-slate-50 to-white">
            {messages.map((message) => (
              <div
                key={message.id}
                className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
              >
                <div
                  className={`max-w-[80%] rounded-2xl px-4 py-3 ${
                    message.sender === 'user'
                      ? 'bg-gradient-to-r from-amber-500 to-orange-600 text-white'
                      : 'bg-white border-2 border-gray-200 text-gray-800 shadow-sm'
                  }`}
                >
                  <p className="text-sm whitespace-pre-line leading-relaxed">{message.text}</p>
                  <span className={`text-xs mt-1 block ${
                    message.sender === 'user' ? 'text-white/80' : 'text-gray-500'
                  }`}>
                    {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                  </span>
                </div>
              </div>
            ))}
            <div ref={messagesEndRef} />
          </div>

          <div className="p-4 border-t-2 border-gray-200 bg-white rounded-b-2xl">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                onKeyPress={handleKeyPress}
                placeholder={language === 'en' ? 'Ask about safety...' : 'рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗрдВ...'}
                className="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all"
              />
              <button
                onClick={handleSend}
                disabled={!inputText.trim()}
                className="bg-gradient-to-r from-amber-500 to-orange-600 text-white p-3 rounded-xl hover:from-amber-600 hover:to-orange-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:shadow-lg"
              >
                <Send className="w-5 h-5" />
              </button>
            </div>
            <p className="text-xs text-gray-500 mt-2 text-center">
              {language === 'en'
                ? '24/7 Emergency assistance available'
                : '24/7 рдЖрдкрд╛рддрдХрд╛рд▓реАрди рд╕рд╣рд╛рдпрддрд╛ рдЙрдкрд▓рдмреНрдз'}
            </p>
          </div>
        </div>
      )}
    </>
  );
}
